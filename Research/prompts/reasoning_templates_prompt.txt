
Base Header
- You are a senior coding agent working in this repo at the current working directory.
- Keep changes minimal, deterministic, and Windows-first.
- Reuse existing CLI/API/file contracts; do not break public interfaces.
- Validate via tests and local commands; avoid network in tests.
- Acceptance: all existing tests pass + new tests pass + commands run.

Goal
- Implement reasoning templates over KG (obligations, permissions, procedures)

Scope
- - Implement template: obligation_check(Entity, Context): walk requires → excepts → effective_on
- Implement template: permission_with_exception(Entity, Action): permits minus applicable excepts
- Implement template: multi_step_compliance(Entity, Procedure): topological order over ProcedureStep.requires

Key files
- earCrawler/kg/ontology.py:1
- earCrawler/kg/shapes.ttl:1
- earCrawler/kg/shapes_prov.ttl:1
- earCrawler/kg/validate.py:1
- earCrawler/kg/emit_ear.py:1
- service/openapi/openapi.yaml:1
- service/api_server/routers/entities.py:1
- service/api_server/routers/search.py:1
- service/api_server/routers/sparql.py:1

Deliverables
- - SPARQL templates
- tests

Acceptance criteria
- - Templates return correct paths on fixtures
- Explainability payload includes KG paths

Validation commands
- `pytest -q tests/kg tests/test_lineage.py`

Non-goals
- - Model training
